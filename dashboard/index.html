<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent Chewy - Test Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* Dark Mode (default) */
    :root {
      --bg-primary: #0d1117;
      --bg-secondary: #161b22;
      --bg-tertiary: #21262d;
      --border-color: #30363d;
      --text-primary: #e6edf3;
      --text-secondary: #8b949e;
      --accent-green: #22c55e;
      --accent-blue: #3b82f6;
      --accent-purple: #a371f7;
      --accent-orange: #f59e0b;
      --accent-red: #ef4444;
      --accent-cyan: #06b6d4;
      --sidebar-bg: #161b22;
      --card-shadow: none;
    }

    /* Light Mode - BlinqIO Style */
    :root.light {
      --bg-primary: #f8fafc;
      --bg-secondary: #ffffff;
      --bg-tertiary: #f1f5f9;
      --border-color: #e2e8f0;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --accent-green: #22c55e;
      --accent-blue: #3b82f6;
      --accent-purple: #8b5cf6;
      --accent-orange: #f59e0b;
      --accent-red: #ef4444;
      --accent-cyan: #06b6d4;
      --sidebar-bg: #ffffff;
      --card-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      --terminal-bg: #1e293b;
    }

    /* Light mode specific overrides */
    :root.light .terminal,
    :root.light .terminal-body,
    :root.light #scenario-terminal {
      background: #1e293b !important;
      color: #e2e8f0 !important;
    }

    :root.light .terminal-header {
      background: #334155 !important;
    }

    :root.light .logo-icon {
      background: linear-gradient(135deg, #22c55e, #3b82f6);
    }

    :root.light .logo-text {
      background: linear-gradient(135deg, #22c55e, #3b82f6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    :root.light .nav-item.active {
      background: rgba(34, 197, 94, 0.1);
      color: #16a34a;
    }

    :root.light .step-keyword.given { color: #7c3aed; }
    :root.light .step-keyword.when { color: #d97706; }
    :root.light .step-keyword.then { color: #16a34a; }
    :root.light .step-keyword.and { color: #64748b; }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
    }

    .app {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 260px;
      background: var(--sidebar-bg);
      border-right: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      position: fixed;
      height: 100vh;
    }

    .logo {
      padding: 20px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }

    .logo-text {
      font-weight: 700;
      font-size: 18px;
      background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .nav {
      flex: 1;
      padding: 16px 12px;
    }

    .nav-section {
      margin-bottom: 24px;
    }

    .nav-section-title {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      color: var(--text-secondary);
      padding: 0 12px;
      margin-bottom: 8px;
      letter-spacing: 0.5px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      border-radius: 8px;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .nav-item:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .nav-item.active {
      background: rgba(88, 166, 255, 0.1);
      color: var(--accent-blue);
    }

    .nav-item-icon {
      font-size: 18px;
      width: 20px;
      text-align: center;
    }

    .nav-item-badge {
      margin-left: auto;
      background: var(--accent-green);
      color: var(--bg-primary);
      font-size: 11px;
      font-weight: 600;
      padding: 2px 8px;
      border-radius: 10px;
    }

    /* Main Content */
    .main {
      flex: 1;
      margin-left: 260px;
      display: flex;
      flex-direction: column;
    }

    .header {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      padding: 16px 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .breadcrumb {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .breadcrumb-sep {
      color: var(--border-color);
    }

    .breadcrumb-current {
      color: var(--text-primary);
      font-weight: 500;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      border: none;
      transition: all 0.15s ease;
    }

    .btn-primary {
      background: var(--accent-green);
      color: #ffffff;
    }

    .btn-primary:hover {
      background: #16a34a;
      filter: brightness(1.1);
    }

    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      border-color: var(--text-secondary);
    }

    .content {
      flex: 1;
      padding: 32px;
      overflow-y: auto;
    }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 20px;
      box-shadow: var(--card-shadow);
    }

    .stat-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .stat-card-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }

    .stat-card-icon.green { background: rgba(63, 185, 80, 0.15); color: var(--accent-green); }
    .stat-card-icon.blue { background: rgba(88, 166, 255, 0.15); color: var(--accent-blue); }
    .stat-card-icon.purple { background: rgba(163, 113, 247, 0.15); color: var(--accent-purple); }
    .stat-card-icon.orange { background: rgba(210, 153, 34, 0.15); color: var(--accent-orange); }

    .stat-value {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .stat-label {
      color: var(--text-secondary);
      font-size: 14px;
    }

    /* Panels */
    .panels {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
    }

    .panel {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: var(--card-shadow);
    }

    .panel-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .panel-title {
      font-size: 16px;
      font-weight: 600;
    }

    .panel-body {
      padding: 0;
    }

    /* Scenarios List */
    .scenario-item {
      display: flex;
      align-items: center;
      padding: 10px 14px;
      border-bottom: 1px solid var(--border-color);
      cursor: pointer;
      transition: background 0.15s ease;
    }

    .scenario-item:last-child {
      border-bottom: none;
    }

    .scenario-item:hover {
      background: var(--bg-tertiary);
    }

    .scenario-status {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 10px;
      flex-shrink: 0;
    }

    .scenario-status.passed { background: var(--accent-green); }
    .scenario-status.failed { background: var(--accent-red); }
    .scenario-status.pending { background: var(--accent-orange); }
    .scenario-status.ready { background: var(--accent-blue); }

    .scenario-item.selected {
      background: var(--bg-tertiary);
      border-left: 3px solid var(--accent-green);
    }

    .step-item {
      display: flex;
      align-items: flex-start;
      padding: 6px 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    .step-item:last-child {
      border-bottom: none;
    }

    .step-icon {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 10px;
      font-size: 9px;
      flex-shrink: 0;
      margin-top: 1px;
    }

    .step-icon.given { background: rgba(99, 102, 241, 0.2); color: #818cf8; }
    .step-icon.when { background: rgba(245, 158, 11, 0.2); color: #fbbf24; }
    .step-icon.then { background: rgba(16, 185, 129, 0.2); color: #34d399; }
    .step-icon.and { background: rgba(107, 114, 128, 0.2); color: #9ca3af; }

    .step-content {
      flex: 1;
      font-size: 12px;
      line-height: 1.5;
    }

    .step-keyword {
      font-weight: 600;
      margin-right: 6px;
      font-size: 11px;
    }

    .step-keyword.given { color: #818cf8; }
    .step-keyword.when { color: #fbbf24; }
    .step-keyword.then { color: #34d399; }
    .step-keyword.and { color: #9ca3af; }

    .step-text {
      color: var(--text-secondary);
      font-size: 12px;
    }

    .examples-table {
      margin-top: 12px;
      background: var(--bg-tertiary);
      border-radius: 6px;
      padding: 12px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 11px;
      overflow-x: auto;
    }

    .examples-title {
      color: var(--accent-purple);
      font-weight: 600;
      margin-bottom: 6px;
      font-size: 11px;
    }

    .scenario-tags {
      display: flex;
      gap: 6px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }

    .scenario-tag-badge {
      background: var(--bg-tertiary);
      color: var(--accent-green);
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 10px;
      font-family: 'JetBrains Mono', monospace;
    }

    .steps-list {
      background: var(--bg-secondary);
      border-radius: 8px;
      padding: 12px;
      border: 1px solid var(--border-color);
    }

    .report-item:hover {
      background: var(--bg-tertiary);
    }

    .scenario-info {
      flex: 1;
    }

    .scenario-name {
      font-size: 12px;
      font-weight: 500;
      margin-bottom: 2px;
      line-height: 1.3;
    }

    .scenario-meta {
      font-size: 10px;
      color: var(--text-secondary);
    }

    .scenario-tag {
      background: var(--bg-tertiary);
      color: var(--accent-cyan);
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 4px;
      font-family: 'JetBrains Mono', monospace;
    }

    /* Feature Viewer */
    .feature-viewer {
      padding: 20px;
    }

    .feature-code {
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 16px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      line-height: 1.6;
      overflow-x: auto;
    }

    .gherkin-keyword {
      color: var(--accent-purple);
      font-weight: 600;
    }

    .gherkin-string {
      color: var(--accent-green);
    }

    .gherkin-param {
      color: var(--accent-orange);
    }

    /* Context Panel */
    .context-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      padding: 20px;
    }

    .context-stat {
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 16px;
      text-align: center;
    }

    .context-stat-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent-cyan);
      margin-bottom: 4px;
    }

    .context-stat-label {
      font-size: 12px;
      color: var(--text-secondary);
    }

    /* Terminal */
    .terminal {
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      margin: 20px;
      overflow: hidden;
    }

    .terminal-header {
      background: var(--bg-tertiary);
      padding: 8px 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .terminal-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    .terminal-dot.red { background: #ff5f56; }
    .terminal-dot.yellow { background: #ffbd2e; }
    .terminal-dot.green { background: #27c93f; }

    .terminal-body {
      padding: 16px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      line-height: 1.6;
      max-height: 200px;
      overflow-y: auto;
    }

    .terminal-line {
      margin-bottom: 4px;
    }

    .terminal-prompt {
      color: var(--accent-cyan);
    }

    .terminal-success {
      color: var(--accent-green);
    }

    .terminal-error {
      color: var(--accent-red);
    }

    /* Generate Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      width: 600px;
      max-width: 90vw;
    }

    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 600;
    }

    .modal-close {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 24px;
      cursor: pointer;
    }

    .modal-body {
      padding: 24px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 8px;
    }

    .form-input {
      width: 100%;
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 12px 16px;
      font-size: 14px;
      color: var(--text-primary);
      font-family: inherit;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--accent-blue);
    }

    .form-select {
      width: 100%;
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 12px 16px;
      font-size: 14px;
      color: var(--text-primary);
      cursor: pointer;
    }

    .modal-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

    /* Animations */
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .loading {
      animation: pulse 1.5s infinite;
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo">
        <div class="logo-icon">üêï</div>
        <span class="logo-text">Agent Chewy</span>
      </div>
      
      <nav class="nav">
        <div class="nav-section">
          <div class="nav-section-title">Overview</div>
          <a class="nav-item active" onclick="showPage('dashboard')">
            <span class="nav-item-icon">üìä</span>
            Dashboard
          </a>
          <a class="nav-item" onclick="showPage('scenarios')">
            <span class="nav-item-icon">üìã</span>
            Scenarios
            <span class="nav-item-badge" id="scenario-count">0</span>
          </a>
          <a class="nav-item" onclick="showPage('executions')">
            <span class="nav-item-icon">‚ñ∂Ô∏è</span>
            Executions
          </a>
          <a class="nav-item" onclick="showPage('reports')">
            <span class="nav-item-icon">üìà</span>
            Reports
          </a>
        </div>
        
        <div class="nav-section">
          <div class="nav-section-title">Teams</div>
          <a class="nav-item" onclick="selectTeam('avs')">
            <span class="nav-item-icon">üìç</span>
            AVS (Address)
          </a>
          <a class="nav-item" onclick="selectTeam('kyrios')">
            <span class="nav-item-icon">üë§</span>
            Kyrios (Users)
          </a>
        </div>
        
        <div class="nav-section">
          <div class="nav-section-title">Tools</div>
          <a class="nav-item" onclick="showPage('context')">
            <span class="nav-item-icon">üìö</span>
            Context Library
          </a>
          <a class="nav-item" onclick="openGenerateModal()">
            <span class="nav-item-icon">‚ú®</span>
            Generate Tests
          </a>
          <a class="nav-item" onclick="showPage('docs')">
            <span class="nav-item-icon">üìñ</span>
            Documentation
          </a>
        </div>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main">
      <header class="header">
        <div class="header-left">
          <div class="breadcrumb">
            <span>Agent Chewy</span>
            <span class="breadcrumb-sep">/</span>
            <span class="breadcrumb-current" id="current-page">Dashboard</span>
          </div>
        </div>
        <div class="header-actions">
          <button class="btn" onclick="toggleTheme()" style="background: var(--bg-tertiary);" id="theme-toggle" title="Toggle Light/Dark Mode">
            üåô
          </button>
          <button class="btn" onclick="loadScenarios()" style="background: var(--bg-tertiary);">
            üîÑ Refresh
          </button>
          <button class="btn btn-danger" onclick="clearAllScenarios()" style="background: var(--accent-red);">
            üóëÔ∏è Clear All
          </button>
          <button class="btn btn-secondary" onclick="runValidation()">
            üîç Validate Context
          </button>
          <button class="btn btn-primary" onclick="openGenerateModal()">
            ‚ú® Generate Test
          </button>
        </div>
      </header>

      <div class="content" id="content">
        <!-- Dashboard Page -->
        <div id="page-dashboard">
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-card-header">
                <div class="stat-card-icon green">‚úì</div>
              </div>
              <div class="stat-value" id="stat-passed">0</div>
              <div class="stat-label">Tests Passed</div>
            </div>
            <div class="stat-card">
              <div class="stat-card-header">
                <div class="stat-card-icon blue">üìã</div>
              </div>
              <div class="stat-value" id="stat-scenarios">0</div>
              <div class="stat-label">Total Scenarios</div>
            </div>
            <div class="stat-card">
              <div class="stat-card-header">
                <div class="stat-card-icon purple">üìö</div>
              </div>
              <div class="stat-value" id="stat-patterns">0</div>
              <div class="stat-label">Test Patterns</div>
            </div>
            <div class="stat-card">
              <div class="stat-card-header">
                <div class="stat-card-icon orange">üìú</div>
              </div>
              <div class="stat-value" id="stat-rules">0</div>
              <div class="stat-label">Business Rules</div>
            </div>
          </div>

          <div class="panels">
            <div class="panel">
              <div class="panel-header">
                <span class="panel-title">Recent Scenarios</span>
                <button class="btn btn-secondary" onclick="showPage('scenarios')">View All</button>
              </div>
              <div class="panel-body" id="recent-scenarios">
                <!-- Populated by JS -->
              </div>
            </div>

            <div class="panel">
              <div class="panel-header">
                <span class="panel-title">Terminal</span>
              </div>
              <div class="panel-body">
                <div class="terminal">
                  <div class="terminal-header">
                    <div class="terminal-dot red"></div>
                    <div class="terminal-dot yellow"></div>
                    <div class="terminal-dot green"></div>
                  </div>
                  <div class="terminal-body" id="terminal-output">
                    <div class="terminal-line">
                      <span class="terminal-prompt">$</span> Ready to generate tests...
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Scenarios Page -->
        <div id="page-scenarios" style="display: none;">
          <div style="display: grid; grid-template-columns: 300px 1fr; grid-template-rows: 1fr auto; gap: 16px; height: calc(100vh - 140px);">
            <!-- Scenarios List -->
            <div class="panel" style="overflow: auto; grid-row: 1 / 3;">
              <div class="panel-header" style="padding: 12px 16px;">
                <span class="panel-title" style="font-size: 14px;">Scenarios</span>
                <span class="scenario-count" id="scenario-count" style="font-size: 12px;">0</span>
              </div>
              <div class="panel-body" id="all-scenarios" style="padding: 0;">
                <!-- Populated by JS -->
              </div>
            </div>
            
            <!-- Scenario Detail -->
            <div class="panel" style="overflow: auto;">
              <div class="panel-header" style="display: flex; justify-content: space-between; align-items: center; padding: 12px 16px;">
                <span class="panel-title" id="scenario-detail-title" style="font-size: 14px;">Select a scenario</span>
                <button class="btn btn-primary" id="run-scenario-btn" onclick="runSelectedScenario()" style="display: none; padding: 6px 14px; font-size: 13px;">
                  ‚ñ∂Ô∏è Run Test
                </button>
              </div>
              <div class="panel-body" id="scenario-detail" style="padding: 16px;">
                <div style="padding: 40px; text-align: center; color: var(--text-secondary);">
                  <div style="font-size: 40px; margin-bottom: 12px;">üìã</div>
                  <div style="font-size: 13px;">Click a scenario to view details</div>
                </div>
              </div>
            </div>
            
            <!-- Terminal Output -->
            <div class="panel" id="scenario-terminal-panel" style="height: 180px; display: flex; flex-direction: column;">
              <div class="panel-header" style="padding: 8px 16px; flex-shrink: 0;">
                <span class="panel-title" style="font-size: 12px;">Terminal Output</span>
                <button class="btn" onclick="clearScenarioTerminal()" style="padding: 4px 8px; font-size: 11px; background: var(--bg-tertiary);">Clear</button>
              </div>
              <div class="terminal" id="scenario-terminal" style="flex: 1; overflow: auto; padding: 12px; font-size: 12px; margin: 0; border-radius: 0 0 12px 12px;">
                <div class="terminal-line">
                  <span style="color: var(--accent-green);">$</span> Ready to run tests...
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Context Page -->
        <div id="page-context" style="display: none;">
          <div class="panel">
            <div class="panel-header">
              <span class="panel-title">Context Library - <span id="context-team">AVS</span></span>
            </div>
            <div class="panel-body">
              <div class="context-stats" id="context-stats">
                <!-- Populated by JS -->
              </div>
              <div class="feature-viewer">
                <h4 style="margin-bottom: 12px; color: var(--text-secondary);">Response Code Behaviors</h4>
                <div class="feature-code" id="context-behaviors">
                  <!-- Populated by JS -->
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Executions Page -->
        <div id="page-executions" style="display: none;">
          <div class="panel">
            <div class="panel-header">
              <span class="panel-title">Test Executions</span>
              <button class="btn btn-primary" onclick="runAllTests()">‚ñ∂Ô∏è Run All Tests</button>
            </div>
            <div class="panel-body">
              <div id="executions-list">
                <!-- Populated by JS -->
              </div>
            </div>
          </div>
        </div>

        <!-- Reports Page -->
        <div id="page-reports" style="display: none;">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
            <!-- Summary Stats -->
            <div class="panel">
              <div class="panel-header" style="padding: 12px 16px;">
                <span class="panel-title" style="font-size: 14px;">Test Summary</span>
              </div>
              <div class="panel-body" style="padding: 20px;">
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; text-align: center;">
                  <div>
                    <div style="font-size: 32px; font-weight: 700; color: var(--text-primary);" id="report-total">0</div>
                    <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">Total Runs</div>
                  </div>
                  <div>
                    <div style="font-size: 32px; font-weight: 700; color: var(--accent-green);" id="report-passed">0</div>
                    <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">Passed</div>
                  </div>
                  <div>
                    <div style="font-size: 32px; font-weight: 700; color: var(--accent-red);" id="report-failed">0</div>
                    <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">Failed</div>
                  </div>
                  <div>
                    <div style="font-size: 32px; font-weight: 700; color: var(--accent-blue);" id="report-rate">0%</div>
                    <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">Pass Rate</div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Pass Rate Chart -->
            <div class="panel">
              <div class="panel-header" style="padding: 12px 16px;">
                <span class="panel-title" style="font-size: 14px;">Pass Rate Trend</span>
              </div>
              <div class="panel-body" style="padding: 20px;">
                <div id="pass-rate-chart" style="display: flex; align-items: flex-end; height: 80px; gap: 8px;">
                  <!-- Populated by JS -->
                </div>
              </div>
            </div>
          </div>
          
          <!-- Recent Test Runs -->
          <div class="panel">
            <div class="panel-header" style="padding: 12px 16px; display: flex; justify-content: space-between;">
              <span class="panel-title" style="font-size: 14px;">Recent Test Runs</span>
              <button class="btn" onclick="clearReports()" style="padding: 4px 10px; font-size: 11px; background: var(--bg-tertiary);">Clear History</button>
            </div>
            <div class="panel-body" style="padding: 0;">
              <div id="reports-list">
                <!-- Populated by JS -->
              </div>
            </div>
          </div>
        </div>

        <!-- Documentation Page - Landing Style -->
        <div id="page-docs" style="display: none; overflow-y: auto; height: calc(100vh - 100px);">
          
          <!-- Hero Section -->
          <div style="text-align: center; padding: 60px 40px; background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(59, 130, 246, 0.1)); border-radius: 16px; margin-bottom: 48px;">
            <h1 style="font-size: 42px; font-weight: 700; color: var(--text-primary); margin-bottom: 16px; line-height: 1.2;">
              Generate API tests from<br>
              <span style="background: linear-gradient(135deg, var(--accent-green), var(--accent-blue)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">natural language</span>
            </h1>
            <p style="font-size: 18px; color: var(--text-secondary); max-width: 650px; margin: 0 auto 32px; line-height: 1.6;">
              Agent Chewy turns plain English into production-ready Cucumber/BDD API tests. Powered by a smart context library built from your actual service code.
            </p>
            <button class="btn btn-primary" onclick="openGenerateModal()" style="padding: 14px 32px; font-size: 16px; border-radius: 12px;">
              ‚ú® Generate Your First Test
            </button>
          </div>

          <!-- How It Works -->
          <div style="margin-bottom: 48px;">
            <h2 style="text-align: center; font-size: 28px; font-weight: 700; color: var(--text-primary); margin-bottom: 48px;">
              How it works
            </h2>

            <!-- Step 1: Build Context -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: start; margin-bottom: 64px;">
              <div>
                <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
                  <div style="width: 48px; height: 48px; background: var(--accent-green); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 700; color: white;">01</div>
                  <h3 style="font-size: 24px; font-weight: 600; color: var(--text-primary);">Build context from source code</h3>
                </div>
                
                <p style="font-size: 15px; color: var(--text-secondary); line-height: 1.8; margin-bottom: 16px;">
                  <strong style="color: var(--text-primary);">What does this mean?</strong><br>
                  Instead of manually writing test cases, Agent Chewy reads your actual service code to understand how the API behaves. It learns the business rules, response codes, and edge cases directly from the source‚Äîso your tests are always accurate.
                </p>

                <p style="font-size: 15px; color: var(--text-secondary); line-height: 1.8; margin-bottom: 16px;">
                  <strong style="color: var(--text-primary);">How it works:</strong><br>
                  Point it at your service repository. Agent Chewy scans Java/TypeScript files, finds test data patterns, extracts validation logic, and builds a "context library"‚Äîa knowledge base about your API.
                </p>

                <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 16px; margin-bottom: 12px;">
                  <div style="font-size: 12px; color: var(--accent-green); font-weight: 600; margin-bottom: 8px;">üìå Example</div>
                  <code style="font-size: 12px; color: var(--text-secondary); display: block; line-height: 1.6;">
                    $ npm run context:avs<br>
                    ‚úÖ Scanned 24 source files<br>
                    ‚úÖ Extracted 46 test data patterns<br>
                    ‚úÖ Found 74 business rules<br>
                    ‚úÖ Identified 5 response codes
                  </code>
                </div>

                <div style="font-size: 13px; color: var(--text-secondary);">
                  <strong style="color: var(--accent-green);">What it extracts:</strong> Response codes (VERIFIED, CORRECTED, etc.), validation rules, working test addresses, edge cases
                </div>
              </div>
              <div style="background: var(--bg-tertiary); border-radius: 12px; overflow: hidden; min-height: 280px; display: flex; align-items: center; justify-content: center;">
                <img src="/recordings/step1-context.gif" alt="Building context library" style="width: 100%; height: auto; border-radius: 12px;">
              </div>
            </div>

            <!-- Step 2: Describe Test -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: start; margin-bottom: 64px;">
              <div style="background: var(--bg-tertiary); border-radius: 12px; overflow: hidden; min-height: 280px; display: flex; align-items: center; justify-content: center; order: -1;">
                <img src="/recordings/step2-nlp.gif" alt="NLP test generation" style="width: 100%; height: auto; border-radius: 12px;">
              </div>
              <div>
                <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
                  <div style="width: 48px; height: 48px; background: var(--accent-blue); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 700; color: white;">02</div>
                  <h3 style="font-size: 24px; font-weight: 600; color: var(--text-primary);">Describe your test in plain English</h3>
                </div>
                
                <p style="font-size: 15px; color: var(--text-secondary); line-height: 1.8; margin-bottom: 16px;">
                  <strong style="color: var(--text-primary);">What does this mean?</strong><br>
                  No need to learn Cucumber syntax or write code. Just describe what you want to test like you're talking to a colleague. Agent Chewy understands your intent and generates the complete test.
                </p>

                <p style="font-size: 15px; color: var(--text-secondary); line-height: 1.8; margin-bottom: 16px;">
                  <strong style="color: var(--text-primary);">How it works:</strong><br>
                  Your plain English is matched against the context library. It finds the right test data, expected response code, and generates proper assertions‚Äîall without calling OpenAI (fast & free!).
                </p>

                <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 16px; margin-bottom: 12px;">
                  <div style="font-size: 12px; color: var(--accent-blue); font-weight: 600; margin-bottom: 8px;">üìå Example</div>
                  <div style="font-size: 12px; color: var(--text-secondary); line-height: 1.8;">
                    <strong>You type:</strong> "Test missing postal code returns CORRECTED"<br><br>
                    <strong>Agent Chewy generates:</strong><br>
                    ‚Ä¢ <code>missing-postal-corrected.feature</code> (Gherkin scenario)<br>
                    ‚Ä¢ <code>missing-postal-corrected.steps.ts</code> (TypeScript code)<br>
                    ‚Ä¢ Uses real test address with empty postal code<br>
                    ‚Ä¢ Expects responseCode = "CORRECTED"
                  </div>
                </div>

                <div style="font-size: 13px; color: var(--text-secondary);">
                  <strong style="color: var(--accent-blue);">Try these:</strong> "Test valid address", "Test fake address returns NOT_VERIFIED", "Test wrong unit number"
                </div>
              </div>
            </div>

            <!-- Step 3: Run & View -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: start; margin-bottom: 64px;">
              <div>
                <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
                  <div style="width: 48px; height: 48px; background: var(--accent-purple); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 700; color: white;">03</div>
                  <h3 style="font-size: 24px; font-weight: 600; color: var(--text-primary);">Run tests & inspect results</h3>
                </div>
                
                <p style="font-size: 15px; color: var(--text-secondary); line-height: 1.8; margin-bottom: 16px;">
                  <strong style="color: var(--text-primary);">What does this mean?</strong><br>
                  Execute your generated tests against the real API with one click. See exactly what was sent, what came back, and whether assertions passed‚Äîfull visibility into every API call.
                </p>

                <p style="font-size: 15px; color: var(--text-secondary); line-height: 1.8; margin-bottom: 16px;">
                  <strong style="color: var(--text-primary);">How it works:</strong><br>
                  Click ‚ñ∂Ô∏è Run Test. Agent Chewy sends the request to your API, captures the response, validates against your Swagger schema, and logs everything to Reports.
                </p>

                <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 16px; margin-bottom: 12px;">
                  <div style="font-size: 12px; color: var(--accent-purple); font-weight: 600; margin-bottom: 8px;">üìå Example Report</div>
                  <div style="font-size: 11px; color: var(--text-secondary); font-family: monospace; line-height: 1.6;">
                    üì§ POST /avs/v1.0/verifyAddress<br>
                    {"streets":["123 Main St"],"city":"Boston"...}<br><br>
                    üì• Status: 200<br>
                    {"responseCode":"VERIFIED","validatedAddress":{...}}<br><br>
                    ‚úÖ Schema validation passed<br>
                    ‚úÖ All assertions passed (1.2s)
                  </div>
                </div>

                <div style="font-size: 13px; color: var(--text-secondary);">
                  <strong style="color: var(--accent-purple);">Reports include:</strong> Request body, response body, HTTP status, duration, pass/fail, schema validation
                </div>
              </div>
              <div style="background: var(--bg-tertiary); border-radius: 12px; overflow: hidden; min-height: 280px; display: flex; align-items: center; justify-content: center;">
                <img src="/recordings/step3-run.gif" alt="Running test & viewing report" style="width: 100%; height: auto; border-radius: 12px;">
              </div>
            </div>

            <!-- Step 4: Self-Heal -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: start; margin-bottom: 48px;">
              <div style="background: var(--bg-tertiary); border-radius: 12px; overflow: hidden; min-height: 280px; display: flex; align-items: center; justify-content: center; order: -1;">
                <img src="/recordings/step4-validate.gif" alt="Context validation & auto-fix" style="width: 100%; height: auto; border-radius: 12px;">
              </div>
              <div>
                <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
                  <div style="width: 48px; height: 48px; background: var(--accent-orange); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: 700; color: white;">04</div>
                  <h3 style="font-size: 24px; font-weight: 600; color: var(--text-primary);">Self-healing context validation</h3>
                </div>
                
                <p style="font-size: 15px; color: var(--text-secondary); line-height: 1.8; margin-bottom: 16px;">
                  <strong style="color: var(--text-primary);">What does this mean?</strong><br>
                  APIs change over time. Instead of manually updating tests, Agent Chewy can detect when your context library is out of sync with the real API and automatically fix it.
                </p>

                <p style="font-size: 15px; color: var(--text-secondary); line-height: 1.8; margin-bottom: 16px;">
                  <strong style="color: var(--text-primary);">How it works:</strong><br>
                  Run the validator. It calls the real API with test data for each response code, compares actual vs expected behavior, and updates your context library if there's a mismatch.
                </p>

                <div style="background: var(--bg-tertiary); border-radius: 8px; padding: 16px; margin-bottom: 12px;">
                  <div style="font-size: 12px; color: var(--accent-orange); font-weight: 600; margin-bottom: 8px;">üìå Example Auto-Fix</div>
                  <div style="font-size: 12px; color: var(--text-secondary); line-height: 1.8;">
                    <strong>Problem detected:</strong><br>
                    Context says PREMISES_PARTIAL ‚Üí validatedAddress = "populated"<br>
                    But API actually returns ‚Üí validatedAddress = null<br><br>
                    <strong>Auto-fix applied:</strong><br>
                    ‚úÖ Updated api-context.json: validatedAddressState = "null"<br>
                    ‚úÖ Future tests will use correct assertion
                  </div>
                </div>

                <div style="font-size: 13px; color: var(--text-secondary);">
                  <strong style="color: var(--accent-orange);">Command:</strong> <code style="background: var(--bg-primary); padding: 2px 6px; border-radius: 4px;">npm run validate:avs:fix</code>
                </div>
              </div>
            </div>
          </div>

          
        </div>
      </div>
    </main>
  </div>

  <!-- Generate Modal -->
  <div class="modal-overlay" id="generate-modal">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-title">‚ú® Generate Test from NLP</span>
        <button class="modal-close" onclick="closeGenerateModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Team</label>
          <select class="form-select" id="generate-team">
            <option value="avs">AVS (Address Validation)</option>
            <option value="kyrios">Kyrios (User Management)</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Describe your test scenario</label>
          <input type="text" class="form-input" id="generate-input" 
                 placeholder="e.g., Verify valid address returns VERIFIED response">
        </div>
        <div class="form-group">
          <label class="form-label">Options</label>
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="generate-run" checked>
            <span>Run tests after generation</span>
          </label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeGenerateModal()">Cancel</button>
        <button class="btn btn-primary" onclick="generateTest()">Generate Test</button>
      </div>
    </div>
  </div>

  <!-- Report Detail Modal -->
  <div class="modal-overlay" id="report-modal">
    <div class="modal" style="max-width: 800px;">
      <div class="modal-header">
        <span class="modal-title" id="report-modal-title">Test Report Details</span>
        <button class="modal-close" onclick="closeReportModal()">&times;</button>
      </div>
      <div class="modal-body" style="max-height: 70vh; overflow: auto;">
        <div id="report-detail-content">
          <!-- Populated by JS -->
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeReportModal()">Close</button>
      </div>
    </div>
  </div>

  <script>
    // Sample data - in real app, this would come from the API
    let scenarios = [];
    let contextData = null;
    let currentTeam = 'avs';
    let selectedScenario = null;

    // Theme management
    function toggleTheme() {
      const html = document.documentElement;
      const isLight = html.classList.toggle('light');
      document.getElementById('theme-toggle').textContent = isLight ? '‚òÄÔ∏è' : 'üåô';
      localStorage.setItem('theme', isLight ? 'light' : 'dark');
    }

    function loadTheme() {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'light') {
        document.documentElement.classList.add('light');
        document.getElementById('theme-toggle').textContent = '‚òÄÔ∏è';
      }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', async () => {
      loadTheme();
      await loadScenarios();
      await loadContext();
      // Default to Documentation page
      showPageDirect('docs');
    });
    
    // Show page without event (for initial load)
    function showPageDirect(page) {
      document.querySelectorAll('[id^="page-"]').forEach(el => el.style.display = 'none');
      document.getElementById(`page-${page}`).style.display = 'block';
      document.getElementById('current-page').textContent = page === 'docs' ? 'Documentation' : page.charAt(0).toUpperCase() + page.slice(1);
      
      document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(el => {
        if (el.getAttribute('onclick')?.includes(`'${page}'`)) {
          el.classList.add('active');
        }
      });
    }

    function showPage(page) {
      document.querySelectorAll('[id^="page-"]').forEach(el => el.style.display = 'none');
      document.getElementById(`page-${page}`).style.display = 'block';
      document.getElementById('current-page').textContent = page.charAt(0).toUpperCase() + page.slice(1);
      
      document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
      event.target.closest('.nav-item').classList.add('active');
      
      // Load page-specific data
      if (page === 'executions') {
        loadExecutions();
      } else if (page === 'reports') {
        loadReports();
      }
    }

    function selectTeam(team) {
      currentTeam = team;
      loadScenarios();
      loadContext();
    }

    async function loadScenarios() {
      try {
        const response = await fetch(`/api/teams/${currentTeam}/scenarios`);
        scenarios = await response.json();
      } catch (error) {
        console.error('Failed to load scenarios:', error);
        scenarios = [];
      }

      // Update stats
      document.getElementById('stat-scenarios').textContent = scenarios.length;
      document.getElementById('stat-passed').textContent = scenarios.filter(s => s.status === 'passed').length;
      document.getElementById('scenario-count').textContent = scenarios.length;

      // Render scenarios or empty state
      if (scenarios.length === 0) {
        const emptyHtml = '<div style="padding: 20px; text-align: center; color: var(--text-secondary);">No scenarios yet. Click "Generate Test" to create one.</div>';
        document.getElementById('recent-scenarios').innerHTML = emptyHtml;
        document.getElementById('all-scenarios').innerHTML = emptyHtml;
      } else {
        // Recent scenarios (dashboard - simple view)
        const recentHtml = scenarios.slice(0, 5).map(s => `
          <div class="scenario-item" onclick="selectScenario('${s.id}')">
            <div class="scenario-status ${s.status}"></div>
            <div class="scenario-info">
              <div class="scenario-name">${s.name}</div>
              <div class="scenario-meta">${(s.tags || []).join(' ')}</div>
            </div>
            <span class="scenario-tag">${(s.team || currentTeam).toUpperCase()}</span>
          </div>
        `).join('');
        document.getElementById('recent-scenarios').innerHTML = recentHtml;
        
        // All scenarios (scenarios page - clickable)
        const allHtml = scenarios.map(s => `
          <div class="scenario-item ${selectedScenario?.id === s.id ? 'selected' : ''}" 
               onclick="selectScenario('${s.id}')" data-id="${s.id}">
            <div class="scenario-status ${s.status}"></div>
            <div class="scenario-info">
              <div class="scenario-name">${s.name}</div>
              <div class="scenario-meta">${(s.tags || []).join(' ')}</div>
            </div>
          </div>
        `).join('');
        document.getElementById('all-scenarios').innerHTML = allHtml;
      }
    }

    function selectScenario(id) {
      selectedScenario = scenarios.find(s => s.id === id);
      if (!selectedScenario) return;

      // Update selection UI
      document.querySelectorAll('.scenario-item').forEach(el => {
        el.classList.toggle('selected', el.dataset.id === id);
      });

      // Show run button
      document.getElementById('run-scenario-btn').style.display = 'inline-flex';
      document.getElementById('scenario-detail-title').textContent = selectedScenario.name;

      // Render scenario detail
      const tagsHtml = (selectedScenario.tags || []).map(t => 
        `<span class="scenario-tag-badge">${t}</span>`
      ).join('');

      const stepsHtml = (selectedScenario.steps || []).map(step => {
        const type = step.type.toLowerCase();
        const icon = type === 'given' ? 'üìã' : type === 'when' ? '‚ö°' : type === 'then' ? '‚úÖ' : '‚ûï';
        
        // Format data table if present
        let dataTableHtml = '';
        if (step.dataTable) {
          const rows = step.dataTable.split('\n').map(row => {
            const cells = row.split('|').filter(c => c.trim()).map(c => c.trim());
            return cells;
          });
          
          if (rows.length > 0) {
            const headerRow = rows[0];
            const dataRows = rows.slice(1);
            
            dataTableHtml = `
              <div class="data-table" style="margin-top: 8px; margin-left: 28px; overflow-x: auto;">
                <table style="border-collapse: collapse; font-size: 10px; font-family: 'JetBrains Mono', monospace;">
                  <thead>
                    <tr style="background: var(--bg-tertiary);">
                      ${headerRow.map(h => `<th style="padding: 6px 10px; border: 1px solid var(--border-color); color: var(--accent-blue);">${escapeHtml(h)}</th>`).join('')}
                    </tr>
                  </thead>
                  <tbody>
                    ${dataRows.map(row => `
                      <tr>
                        ${row.map(cell => `<td style="padding: 6px 10px; border: 1px solid var(--border-color); color: var(--text-primary);">${escapeHtml(cell)}</td>`).join('')}
                      </tr>
                    `).join('')}
                  </tbody>
                </table>
              </div>
            `;
          }
        }
        
        return `
          <div class="step-item" style="flex-direction: column; align-items: flex-start;">
            <div style="display: flex; align-items: flex-start;">
              <div class="step-icon ${type}">${icon}</div>
              <div class="step-content">
                <span class="step-keyword ${type}">${step.type}</span>
                <span class="step-text">${escapeHtml(step.text)}</span>
              </div>
            </div>
            ${dataTableHtml}
          </div>
        `;
      }).join('');

      const examplesHtml = selectedScenario.examples ? `
        <div class="examples-table">
          <div class="examples-title">Examples:</div>
          <pre style="margin: 0; color: var(--text-secondary);">${escapeHtml(selectedScenario.examples)}</pre>
        </div>
      ` : '';

      document.getElementById('scenario-detail').innerHTML = `
        <div class="scenario-tags">${tagsHtml}</div>
        <div class="steps-list">${stepsHtml || '<div style="color: var(--text-secondary);">No steps found</div>'}</div>
        ${examplesHtml}
      `;
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function addScenarioTerminalLine(text, type = 'normal') {
      const terminal = document.getElementById('scenario-terminal');
      const line = document.createElement('div');
      line.className = 'terminal-line';
      
      if (type === 'prompt') {
        line.innerHTML = `<span style="color: var(--accent-green);">$</span> ${escapeHtml(text)}`;
      } else if (type === 'success') {
        line.innerHTML = `<span style="color: var(--accent-green);">${escapeHtml(text)}</span>`;
      } else if (type === 'error') {
        line.innerHTML = `<span style="color: var(--accent-red);">${escapeHtml(text)}</span>`;
      } else {
        line.innerHTML = escapeHtml(text);
      }
      
      terminal.appendChild(line);
      terminal.scrollTop = terminal.scrollHeight;
    }

    function clearScenarioTerminal() {
      const terminal = document.getElementById('scenario-terminal');
      terminal.innerHTML = '<div class="terminal-line"><span style="color: var(--accent-green);">$</span> Ready to run tests...</div>';
    }

    async function runSelectedScenario() {
      if (!selectedScenario) return;

      clearScenarioTerminal();
      addScenarioTerminalLine(`Running: ${selectedScenario.name}`, 'prompt');
      addScenarioTerminalLine('Executing test steps...', 'normal');
      
      // Update button to show loading
      const btn = document.getElementById('run-scenario-btn');
      btn.innerHTML = '‚è≥ Running...';
      btn.disabled = true;

      try {
        const response = await fetch(`/api/scenarios/${selectedScenario.id}/run`, {
          method: 'POST'
        });
        const result = await response.json();

        if (result.passed) {
          addScenarioTerminalLine('', 'normal');
          addScenarioTerminalLine(`‚úÖ TEST PASSED in ${result.duration}`, 'success');
          selectedScenario.status = 'passed';
        } else {
          addScenarioTerminalLine('', 'normal');
          addScenarioTerminalLine(`‚ùå TEST FAILED in ${result.duration}`, 'error');
          if (result.output) {
            // Show relevant error output
            const lines = result.output.split('\n').filter(l => l.trim());
            lines.slice(0, 10).forEach(line => {
              addScenarioTerminalLine(line, 'normal');
            });
          }
          if (result.error) {
            addScenarioTerminalLine(result.error, 'error');
          }
          selectedScenario.status = 'failed';
        }
        
        // Refresh the scenarios list to update status
        await loadScenarios();
        
        // Re-select the scenario to maintain selection
        selectScenario(selectedScenario.id);
      } catch (error) {
        addScenarioTerminalLine(`‚ùå Error: ${error.message}`, 'error');
      }

      btn.innerHTML = '‚ñ∂Ô∏è Run Test';
      btn.disabled = false;
    }

    async function loadContext() {
      try {
        const response = await fetch(`/api/teams/${currentTeam}/context`);
        contextData = await response.json();
      } catch (error) {
        console.error('Failed to load context:', error);
        contextData = { testPatterns: 0, businessRules: 0, responseCodes: [] };
      }

      document.getElementById('stat-patterns').textContent = contextData.testPatterns || 0;
      document.getElementById('stat-rules').textContent = contextData.businessRules || 0;

      document.getElementById('context-stats').innerHTML = `
        <div class="context-stat">
          <div class="context-stat-value">${contextData.testPatterns || 0}</div>
          <div class="context-stat-label">Test Patterns</div>
        </div>
        <div class="context-stat">
          <div class="context-stat-value">${contextData.businessRules || 0}</div>
          <div class="context-stat-label">Business Rules</div>
        </div>
        <div class="context-stat">
          <div class="context-stat-value">${(contextData.responseCodes || []).length}</div>
          <div class="context-stat-label">Response Codes</div>
        </div>
      `;

      const responseCodes = contextData.responseCodes || [];
      const behaviorsHtml = responseCodes.map(rc => `
<span class="gherkin-keyword">${rc.code}</span>
  validatedAddress: <span class="gherkin-string">${rc.validatedAddressState || 'n/a'}</span>
  sanitizedAddress: <span class="gherkin-string">${rc.sanitizedAddressState || 'n/a'}</span>
`).join('\n');
      document.getElementById('context-behaviors').innerHTML = behaviorsHtml || 'No context loaded';
    }

    function openGenerateModal() {
      document.getElementById('generate-modal').classList.add('active');
    }

    function closeGenerateModal() {
      document.getElementById('generate-modal').classList.remove('active');
    }

    async function generateTest() {
      const team = document.getElementById('generate-team').value;
      const input = document.getElementById('generate-input').value;
      const runTests = document.getElementById('generate-run').checked;

      if (!input) {
        alert('Please enter a test description');
        return;
      }

      closeGenerateModal();
      
      // Show in terminal
      addTerminalLine(`$ npm run generate:${team} "${input}"`, 'prompt');
      addTerminalLine('Generating test...', 'normal');
      
      try {
        const response = await fetch('/api/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ team, input, runTests })
        });
        const result = await response.json();
        
        if (result.success) {
          // Parse the output for display
          const output = result.output || '';
          const lines = output.split('\n').filter(l => l.trim());
          
          for (const line of lines.slice(0, 10)) {
            if (line.includes('‚úÖ') || line.includes('passed')) {
              addTerminalLine(line.trim(), 'success');
            } else if (line.includes('‚ùå') || line.includes('failed')) {
              addTerminalLine(line.trim(), 'error');
            } else if (line.trim()) {
              addTerminalLine(line.trim(), 'normal');
            }
          }
          
          addTerminalLine('', 'normal');
          addTerminalLine('üéâ Test generated successfully!', 'success');
        } else {
          addTerminalLine(`‚ùå Error: ${result.error}`, 'error');
        }
      } catch (error) {
        addTerminalLine(`‚ùå Error: ${error.message}`, 'error');
      }
      
      // Refresh scenarios
      await loadScenarios();
    }

    async function loadExecutions() {
      try {
        const response = await fetch(`/api/teams/${currentTeam}/executions`);
        const executions = await response.json();
        
        if (executions.length === 0) {
          document.getElementById('executions-list').innerHTML = `
            <div style="padding: 40px; text-align: center; color: var(--text-secondary);">
              <div style="font-size: 48px; margin-bottom: 16px;">üìã</div>
              <div style="font-size: 18px; margin-bottom: 8px;">No test executions yet</div>
              <div style="font-size: 14px;">Generate and run tests to see execution history here.</div>
            </div>
          `;
        } else {
          const html = executions.map(exec => `
            <div class="execution-item" style="padding: 16px; border-bottom: 1px solid var(--border-color);">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <div style="font-weight: 600; color: var(--text-primary);">${exec.name}</div>
                  <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                    ${exec.date} ‚Ä¢ ${exec.duration}
                  </div>
                </div>
                <div style="display: flex; gap: 12px; align-items: center;">
                  <span style="color: var(--accent-green);">‚úÖ ${exec.passed}</span>
                  <span style="color: var(--accent-red);">‚ùå ${exec.failed}</span>
                </div>
              </div>
            </div>
          `).join('');
          document.getElementById('executions-list').innerHTML = html;
        }
      } catch (error) {
        document.getElementById('executions-list').innerHTML = `
          <div style="padding: 40px; text-align: center; color: var(--text-secondary);">
            <div style="font-size: 48px; margin-bottom: 16px;">üìã</div>
            <div style="font-size: 18px; margin-bottom: 8px;">No test executions yet</div>
            <div style="font-size: 14px;">Generate and run tests to see execution history here.</div>
          </div>
        `;
      }
    }

    async function runAllTests() {
      addTerminalLine(`$ npm run test:${currentTeam}`, 'prompt');
      addTerminalLine('Running all tests...', 'normal');
      
      try {
        const response = await fetch(`/api/test/${currentTeam}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        });
        const result = await response.json();
        
        if (result.success) {
          addTerminalLine(`‚úÖ Tests completed: ${result.passed} passed, ${result.failed} failed`, 'success');
          await loadExecutions();
          await loadScenarios();
        } else {
          addTerminalLine(`‚ùå Error: ${result.error}`, 'error');
        }
      } catch (error) {
        addTerminalLine(`‚ùå Error: ${error.message}`, 'error');
      }
    }

    async function loadReports() {
      try {
        const response = await fetch(`/api/teams/${currentTeam}/reports`);
        const reports = await response.json();
        
        // Calculate summary stats
        const total = reports.length;
        const passed = reports.filter(r => r.status === 'passed').length;
        const failed = reports.filter(r => r.status === 'failed' || r.status === 'error').length;
        const rate = total > 0 ? Math.round((passed / total) * 100) : 0;
        
        document.getElementById('report-total').textContent = total;
        document.getElementById('report-passed').textContent = passed;
        document.getElementById('report-failed').textContent = failed;
        document.getElementById('report-rate').textContent = rate + '%';
        
        // Render pass rate chart (last 10 runs)
        const chartData = reports.slice(0, 10).reverse();
        const chartHtml = chartData.length > 0 ? chartData.map((r, i) => {
          const height = r.status === 'passed' ? 100 : (r.status === 'failed' ? 30 : 10);
          const color = r.status === 'passed' ? 'var(--accent-green)' : 'var(--accent-red)';
          return `<div style="flex: 1; background: ${color}; height: ${height}%; border-radius: 4px 4px 0 0; min-width: 20px;" title="${r.date}: ${r.status}"></div>`;
        }).join('') : '<div style="color: var(--text-secondary); font-size: 12px; text-align: center; width: 100%;">No data yet</div>';
        document.getElementById('pass-rate-chart').innerHTML = chartHtml;
        
        // Render reports list
        if (reports.length === 0) {
          document.getElementById('reports-list').innerHTML = `
            <div style="padding: 40px; text-align: center; color: var(--text-secondary);">
              <div style="font-size: 40px; margin-bottom: 12px;">üìà</div>
              <div style="font-size: 13px;">No test reports yet. Run some tests to see results here.</div>
            </div>
          `;
        } else {
          // Store reports globally for detail view
          window.reportsData = reports;
          
          const reportsHtml = reports.map((r, idx) => {
            const statusIcon = r.status === 'passed' ? '‚úÖ' : r.status === 'failed' ? '‚ùå' : '‚ö†Ô∏è';
            return `
              <div class="report-item" onclick="showReportDetail(${idx})" style="display: flex; align-items: center; padding: 12px 16px; border-bottom: 1px solid var(--border-color); cursor: pointer; transition: background 0.15s;">
                <div style="font-size: 18px; margin-right: 12px;">${statusIcon}</div>
                <div style="flex: 1;">
                  <div style="font-size: 13px; font-weight: 500; color: var(--text-primary);">${r.name}</div>
                  <div style="font-size: 11px; color: var(--text-secondary); margin-top: 2px;">${r.date} ‚Ä¢ Duration: ${r.duration}</div>
                </div>
                <div style="display: flex; gap: 16px; font-size: 12px;">
                  <span style="color: var(--accent-green);">‚úì ${r.passed} passed</span>
                  <span style="color: var(--accent-red);">‚úó ${r.failed} failed</span>
                </div>
                <div style="margin-left: 12px; color: var(--text-secondary);">‚Ä∫</div>
              </div>
            `;
          }).join('');
          document.getElementById('reports-list').innerHTML = reportsHtml;
        }
      } catch (error) {
        console.error('Failed to load reports:', error);
      }
    }

    async function clearReports() {
      if (!confirm('Clear all test reports for ' + currentTeam.toUpperCase() + '?')) return;
      
      try {
        await fetch(`/api/teams/${currentTeam}/reports`, { method: 'DELETE' });
        await loadReports();
      } catch (error) {
        console.error('Failed to clear reports:', error);
      }
    }

    function showReportDetail(idx) {
      const report = window.reportsData[idx];
      if (!report) return;

      const statusIcon = report.status === 'passed' ? '‚úÖ' : '‚ùå';
      const statusText = report.status === 'passed' ? 'PASSED' : 'FAILED';
      const statusColor = report.status === 'passed' ? 'var(--accent-green)' : 'var(--accent-red)';

      document.getElementById('report-modal-title').textContent = report.name;
      
      let html = `
        <div style="margin-bottom: 20px;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
            <span style="font-size: 24px;">${statusIcon}</span>
            <span style="font-size: 18px; font-weight: 600; color: ${statusColor};">${statusText}</span>
            <span style="color: var(--text-secondary); font-size: 13px;">${report.duration}</span>
          </div>
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 16px;">
            <div style="background: var(--bg-tertiary); padding: 12px; border-radius: 8px; text-align: center;">
              <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">Date</div>
              <div style="font-size: 13px; color: var(--text-primary);">${report.date}</div>
            </div>
            <div style="background: var(--bg-tertiary); padding: 12px; border-radius: 8px; text-align: center;">
              <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">Passed</div>
              <div style="font-size: 13px; color: var(--accent-green);">${report.passed}</div>
            </div>
            <div style="background: var(--bg-tertiary); padding: 12px; border-radius: 8px; text-align: center;">
              <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">Failed</div>
              <div style="font-size: 13px; color: var(--accent-red);">${report.failed}</div>
            </div>
          </div>
        </div>
      `;

      // Show request data if available
      if (report.request || report.requestUrl) {
        html += `
          <div style="margin-bottom: 16px;">
            <div style="font-size: 12px; font-weight: 600; color: var(--text-secondary); margin-bottom: 8px;">üì§ REQUEST</div>
            ${report.requestUrl ? `<div style="font-size: 11px; color: var(--accent-blue); margin-bottom: 8px; font-family: monospace;">POST ${report.requestUrl}</div>` : ''}
            ${report.request ? `<pre style="background: var(--bg-tertiary); padding: 12px; border-radius: 8px; font-size: 11px; overflow-x: auto; color: var(--text-primary);">${escapeHtml(report.request)}</pre>` : ''}
          </div>
        `;
      }

      // Show response data if available
      if (report.response || report.responseStatus) {
        html += `
          <div style="margin-bottom: 16px;">
            <div style="font-size: 12px; font-weight: 600; color: var(--text-secondary); margin-bottom: 8px;">üì• RESPONSE</div>
            ${report.responseStatus ? `<div style="font-size: 11px; color: var(--accent-green); margin-bottom: 8px;">Status: ${report.responseStatus}</div>` : ''}
            ${report.response ? `<pre style="background: var(--bg-tertiary); padding: 12px; border-radius: 8px; font-size: 11px; overflow-x: auto; color: var(--text-primary);">${escapeHtml(report.response)}</pre>` : ''}
          </div>
        `;
      }

      // Show error if available
      if (report.error) {
        html += `
          <div style="margin-bottom: 16px;">
            <div style="font-size: 12px; font-weight: 600; color: var(--accent-red); margin-bottom: 8px;">‚ùå ERROR</div>
            <pre style="background: rgba(239, 68, 68, 0.1); padding: 12px; border-radius: 8px; font-size: 11px; overflow-x: auto; color: var(--accent-red);">${escapeHtml(report.error)}</pre>
          </div>
        `;
      }

      // Show full output
      if (report.output) {
        html += `
          <div>
            <div style="font-size: 12px; font-weight: 600; color: var(--text-secondary); margin-bottom: 8px;">üìã TEST OUTPUT</div>
            <pre style="background: var(--bg-tertiary); padding: 12px; border-radius: 8px; font-size: 10px; overflow-x: auto; color: var(--text-secondary); max-height: 300px; overflow-y: auto;">${escapeHtml(report.output)}</pre>
          </div>
        `;
      }

      document.getElementById('report-detail-content').innerHTML = html;
      document.getElementById('report-modal').classList.add('active');
    }

    function closeReportModal() {
      document.getElementById('report-modal').classList.remove('active');
    }

    async function runValidation() {
      addTerminalLine(`$ npm run validate:${currentTeam}`, 'prompt');
      addTerminalLine('Validating context against real API...', 'normal');
      
      try {
        const response = await fetch(`/api/validate/${currentTeam}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ fix: false })
        });
        const result = await response.json();
        
        if (result.success) {
          const output = result.output || '';
          const lines = output.split('\n').filter(l => l.trim());
          
          for (const line of lines) {
            if (line.includes('‚úÖ') || line.includes('PASSED')) {
              addTerminalLine(line.trim(), 'success');
            } else if (line.includes('‚ùå') || line.includes('FAILED')) {
              addTerminalLine(line.trim(), 'error');
            } else if (line.trim()) {
              addTerminalLine(line.trim(), 'normal');
            }
          }
        } else {
          addTerminalLine(`‚ùå Error: ${result.error}`, 'error');
        }
      } catch (error) {
        addTerminalLine(`‚ùå Error: ${error.message}`, 'error');
      }
    }

    async function clearAllScenarios() {
      if (!confirm(`Are you sure you want to delete ALL test scenarios for ${currentTeam.toUpperCase()}?\n\nThis will delete:\n‚Ä¢ All .feature files\n‚Ä¢ All .steps.ts files`)) {
        return;
      }

      addTerminalLine(`$ Clearing all scenarios for ${currentTeam}...`, 'prompt');

      try {
        const response = await fetch(`/api/teams/${currentTeam}/scenarios`, {
          method: 'DELETE'
        });
        const result = await response.json();

        if (result.success) {
          addTerminalLine('‚úÖ All scenarios cleared successfully!', 'success');
          addTerminalLine('', 'normal');
          
          // Refresh the scenarios list from server
          await loadScenarios();
        } else {
          addTerminalLine(`‚ùå Error: ${result.error}`, 'error');
        }
      } catch (error) {
        addTerminalLine(`‚ùå Error: ${error.message}`, 'error');
      }
    }

    function addTerminalLine(text, type) {
      const terminal = document.getElementById('terminal-output');
      const line = document.createElement('div');
      line.className = 'terminal-line';
      
      if (type === 'prompt') {
        line.innerHTML = `<span class="terminal-prompt">$</span> ${text}`;
      } else if (type === 'success') {
        line.innerHTML = `<span class="terminal-success">${text}</span>`;
      } else if (type === 'error') {
        line.innerHTML = `<span class="terminal-error">${text}</span>`;
      } else {
        line.textContent = text;
      }
      
      terminal.appendChild(line);
      terminal.scrollTop = terminal.scrollHeight;
    }
  </script>
</body>
</html>

